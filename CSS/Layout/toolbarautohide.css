/*
Toolbar Auto-Hide
version 2026.02.01
Auto-hides the toolbar row in the sidebar, expands on hover
Granular controls for individual element visibility
*/

/* Before toolbar: collapsed state */
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget {
  margin: 3px !important;
  min-height: 35px !important;
  max-height: fit-content !important;
  overflow: visible !important;
  transition: all var(--animation-speed, 260ms) ease-out;
  align-items: center !important;
}

/* Default: hide all toolbar items except URL bar and workspace popup */
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget > * {
  opacity: 0;
  min-height: 0px;
  max-height: 0px;
  overflow: hidden;
  transition: all var(--animation-speed, 260ms) ease-out;
  flex-shrink: 0;
}

/* Always visible elements - consistent sizes, no shrinking, NO MOVEMENT */
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .UrlBar-AddressField {
  opacity: 1 !important;
  min-height: 36px !important;
  height: 36px !important;
  max-height: 36px !important;
  overflow: visible !important;
  flex-shrink: 0 !important;
  width: 100% !important;
  /* Prevent any movement on state changes */
  margin-left: 0 !important;
  margin-right: 0 !important;
  transform: none !important;
  /* Only animate visual properties */
  transition: 
    background-color var(--animation-speed, 260ms) ease-out,
    box-shadow var(--animation-speed, 260ms) ease-out !important;
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .UrlBar-AddressField:focus-within {
  z-index: var(--z-overlay, 1000) !important;
  overflow: visible !important;
  /* Explicitly prevent movement on focus */
  margin-left: 0 !important;
  margin-right: 0 !important;
  transform: none !important;
  /* Keep width stable - don't change on focus */
  width: 100% !important;
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .workspace-popup {
  opacity: 1 !important;
  min-height: 30px !important;
  height: 30px !important;
  max-height: 30px !important;
  overflow: visible !important;
  flex-shrink: 0 !important;
}

/* Configurable element visibility in collapsed state */
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar.extensions {
  opacity: var(--toolbar-show-extensions, 0);
  min-height: calc(var(--toolbar-show-extensions, 0) * 30px);
  max-height: calc(var(--toolbar-show-extensions, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar:is(.back, .forward, .reload, .home) {
  opacity: var(--toolbar-show-navigation, 0);
  min-height: calc(var(--toolbar-show-navigation, 0) * 30px);
  max-height: calc(var(--toolbar-show-navigation, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar.pageactions {
  opacity: var(--toolbar-show-pageactions, 0);
  min-height: calc(var(--toolbar-show-pageactions, 0) * 30px);
  max-height: calc(var(--toolbar-show-pageactions, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar.readermode {
  opacity: var(--toolbar-show-readermode, 0);
  min-height: calc(var(--toolbar-show-readermode, 0) * 30px);
  max-height: calc(var(--toolbar-show-readermode, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar.bookmarks-button {
  opacity: var(--toolbar-show-bookmarks, 0);
  min-height: calc(var(--toolbar-show-bookmarks, 0) * 30px);
  max-height: calc(var(--toolbar-show-bookmarks, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar.downloads {
  opacity: var(--toolbar-show-downloads, 0);
  min-height: calc(var(--toolbar-show-downloads, 0) * 30px);
  max-height: calc(var(--toolbar-show-downloads, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .button-toolbar:has(> button[title*="ettings"i]) {
  opacity: var(--toolbar-show-settings, 0);
  min-height: calc(var(--toolbar-show-settings, 0) * 30px);
  max-height: calc(var(--toolbar-show-settings, 0) * 30px);
}

.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget .vivaldi-v {
  opacity: var(--toolbar-show-vbutton, 0);
  min-height: calc(var(--toolbar-show-vbutton, 0) * 30px);
  max-height: calc(var(--toolbar-show-vbutton, 0) * 30px);
}

/* Expanded state on hover or focus */
body:has(
    :is(
      #tabs-tabbar-container .toolbar-tabbar-before .UrlBar-AddressField:focus-within,
      .toolbar-editor,
      .toolbar-tabbar-before .ToolbarButton-Button.button-pressed
    )
  )
  .toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget,
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget:hover {
  margin: 3px !important;
  min-height: 35px !important;
  max-height: 100000px !important;
  overflow: visible !important;
  transition: all var(--animation-speed, 260ms) ease-out;
}

/* Show hidden elements when expanded (but don't resize always-visible ones) */
body:has(
    :is(
      #tabs-tabbar-container .toolbar-tabbar-before .UrlBar-AddressField:focus-within,
      .toolbar-editor,
      .toolbar-tabbar-before .ToolbarButton-Button.button-pressed
    )
  )
  .toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget > *:not(.UrlBar-AddressField):not(.workspace-popup),
.toolbar.toolbar-tabbar-before.toolbar-large.toolbar-droptarget:hover > *:not(.UrlBar-AddressField):not(.workspace-popup) {
  opacity: 1 !important;
  min-height: 30px !important;
  max-height: 30px !important;
  z-index: var(--z-modal) !important;
  overflow: visible !important;
  transition: all var(--animation-speed, 260ms) ease-out;
}

/* After toolbar sizing */
#tabs-tabbar-container .toolbar-tabbar-after {
  align-content: flex-end;
  min-height: 35px !important;
  min-width: 100% !important;
}

/* Allow address bar to overflow tabbar when focused */
#tabs-tabbar-container:has(.UrlBar-AddressField:focus-within) {
  overflow: visible !important;
  z-index: var(--z-overlay, 1000) !important;
}

#tabs-tabbar-container:has(.UrlBar-AddressField:focus-within) .toolbar-tabbar-before {
  overflow: visible !important;
  z-index: var(--z-overlay, 1000) !important;
}

/* Ensure URL field inner content shows full URL and icons */
.toolbar.toolbar-tabbar-before .UrlBar-AddressField .UrlBar-UrlFieldWrapper {
  flex: 1 1 auto !important;
  min-width: 0 !important;
  overflow: visible !important;
}

/* 
 * Zen-style: toolbar icons hidden by default, shown on focus 
 * (See addressbar.css for the main implementation)
 * These rules ensure it works in the sidebar tabbar context
 */
.toolbar.toolbar-tabbar-before .UrlBar-AddressField .toolbar-insideinput {
  display: flex !important;
  flex-shrink: 0 !important;
  overflow: visible !important;
  /* Hidden by default - addressbar.css handles the show/hide */
}

/* Show URL icons in sidebar tabbar when focused */
.toolbar.toolbar-tabbar-before .UrlBar-AddressField:focus-within .ToolbarButton-Button {
  display: flex !important;
  flex-shrink: 0 !important;
}
