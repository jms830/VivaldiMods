/*
Native Auto-Hide Polish
version 2026.01.31
Applies Arc-style rounding and transparency to Vivaldi 7.8+ native auto-hide UI
Fixes: https://github.com/jms830/revivarc-vivaldi/issues - ynomas92-ctrl's report
Fixes: Transparent skin support for address bar autohide (ynomas92-ctrl forum request)
*/

/* ============================================ */
/* Native Auto-Hide Wrapper Rounding           */
/* ============================================ */

.auto-hide-wrapper.left,
.auto-hide-wrapper.right {
  border-radius: 0 var(--radius, 12px) var(--radius, 12px) 0 !important;
  overflow: hidden !important;
}

.auto-hide-wrapper.right {
  border-radius: var(--radius, 12px) 0 0 var(--radius, 12px) !important;
}

.auto-hide-wrapper.top {
  border-radius: 0 0 var(--radius, 12px) var(--radius, 12px) !important;
  overflow: visible !important;  /* Changed from hidden to allow trigger zone */
}

/* 
 * HOVER TRIGGER ZONE - Fixes maximized window edge detection
 * Creates an invisible area at the very top of screen that triggers autohide
 * Without this, cursor at screen edge misses the hover target
 */
.auto-hide-wrapper.top::before {
  content: '';
  position: absolute;
  top: -20px;  /* Extends 20px above the wrapper */
  left: 0;
  right: 0;
  height: 20px;
  background: transparent;
  pointer-events: auto;  /* Captures hover events */
  z-index: var(--z-overlay, 1000);
}

.auto-hide-wrapper.bottom {
  border-radius: var(--radius, 12px) var(--radius, 12px) 0 0 !important;
  overflow: hidden !important;
}

/* ============================================ */
/* Base Background (non-transparent themes)    */
/* ============================================ */

/* Default: solid background matching theme */
.auto-hide-wrapper {
  background-color: var(--colorBg) !important;
  border: 1px solid var(--colorBorder, transparent) !important;
}

/* Top bar (address bar) specific - match toolbar styling */
.auto-hide-wrapper.top {
  background-color: var(--colorTabBar, var(--colorBg)) !important;
}

/* Top address BAR inner elements - transparent background */
.auto-hide-wrapper.top .toolbar-mainbar,
.auto-hide-wrapper.top .mainbar {
  background: transparent !important;
}

/* ============================================ */
/* Transparent Skin Support                    */
/* ============================================ */

/*
 * Vivaldi adds .transparent-tabbar to body when "Transparent Tab Bar" is enabled
 * in Settings > Themes > Editor > Settings. This makes autohide wrappers
 * use the same transparency as the rest of the UI.
 *
 * Note: Previous @container style() approach didn't work because CSS custom
 * property values can't be queried that way.
 */

/* When Vivaldi's transparent tabbar mode is active */
body.transparent-tabbar .auto-hide-wrapper,
.transparent-tabbar .auto-hide-wrapper {
  background-color: var(--colorBgAlpha, rgba(30, 30, 30, 0.85)) !important;
  backdrop-filter: blur(12px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
}

/* Ensure address bar wrapper also gets transparency */
body.transparent-tabbar .auto-hide-wrapper.top,
.transparent-tabbar .auto-hide-wrapper.top {
  background-color: var(--colorBgAlpha, rgba(30, 30, 30, 0.85)) !important;
  backdrop-filter: blur(12px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
}

/* Top address BAR - all inner elements transparent when in transparent mode */
body.transparent-tabbar .auto-hide-wrapper.top .toolbar-mainbar,
body.transparent-tabbar .auto-hide-wrapper.top .mainbar,
body.transparent-tabbar .auto-hide-wrapper.top #header,
.transparent-tabbar .auto-hide-wrapper.top .toolbar-mainbar,
.transparent-tabbar .auto-hide-wrapper.top .mainbar,
.transparent-tabbar .auto-hide-wrapper.top #header {
  background: transparent !important;
}

/* Alternative: When accent is transparent (some themes use this) */
#browser.acc-transparent .auto-hide-wrapper,
#browser.color-accent-from-page .auto-hide-wrapper {
  background-color: var(--colorBgAlpha, rgba(30, 30, 30, 0.85)) !important;
  backdrop-filter: blur(12px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
}

/* ============================================ */
/* Animation Smoothing                         */
/* ============================================ */

/* Hide state: smooth deceleration */
.auto-hide-wrapper {
  transition: 
    transform 300ms cubic-bezier(.4, 0, .6, 1),
    opacity var(--animation-speed, 260ms) ease-out,
    background-color var(--animation-speed, 260ms) ease-out !important;
}

/* Show state: slight overshoot for snappy feel */
.auto-hide-wrapper.left.show {
  transition: transform 300ms cubic-bezier(.25, .8, .25, 1.03) !important;
}

.auto-hide-wrapper.right.show {
  transition: transform 300ms cubic-bezier(.25, .8, .25, 1.03) !important;
}

.auto-hide-wrapper.top.show {
  transition: transform 300ms cubic-bezier(.25, .8, .25, 1.02) !important;
}

.auto-hide-wrapper.bottom.show {
  transition: transform 300ms cubic-bezier(.25, .8, .25, 1.02) !important;
}

/* ============================================ */
/* URL Bar Overflow Fix                        */
/* ============================================ */

/*
 * Problem: backdrop-filter creates a stacking context that clips OmniDropdown
 * even with overflow: visible. The dropdown cannot extend beyond the sidebar.
 * 
 * Solution: Disable backdrop-filter AND set overflow visible when URL bar focused.
 */
.auto-hide-wrapper.left:has(.UrlBar-AddressField:focus-within),
.auto-hide-wrapper.right:has(.UrlBar-AddressField:focus-within),
.auto-hide-wrapper.top:has(.UrlBar-AddressField:focus-within),
.auto-hide-wrapper.left:has(.OmniDropdown),
.auto-hide-wrapper.right:has(.OmniDropdown),
.auto-hide-wrapper.top:has(.OmniDropdown) {
  overflow: visible !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* ============================================ */
/* Inner Element Rounding                      */
/* ============================================ */

.auto-hide-wrapper .toolbar-mainbar,
.auto-hide-wrapper #tabs-tabbar-container,
.auto-hide-wrapper .tab-strip,
.auto-hide-wrapper #tabs-container {
  border-radius: inherit !important;
  background-color: inherit !important;
}

.auto-hide-wrapper .UrlBar-AddressField {
  border-radius: calc(var(--radius, 12px) * 0.6) !important;
}

/* Address bar in auto-hide wrapper with transparent tabbar - NO backdrop-filter (causes text ghosting) */
body.transparent-tabbar .auto-hide-wrapper .UrlBar-AddressField,
.transparent-tabbar .auto-hide-wrapper .UrlBar-AddressField {
  background-color: var(--colorBg) !important;
}

body.transparent-tabbar .auto-hide-wrapper .UrlBar-AddressField:focus-within,
.transparent-tabbar .auto-hide-wrapper .UrlBar-AddressField:focus-within {
  background-color: var(--colorBg) !important;
}

/* ============================================ */
/* Corner Gap Fix                              */
/* ============================================ */

.auto-hide-wrapper.left {
  margin-top: var(--window-border, 4px) !important;
  margin-bottom: var(--window-border, 4px) !important;
}

.auto-hide-wrapper.right {
  margin-top: var(--window-border, 4px) !important;
  margin-bottom: var(--window-border, 4px) !important;
}

.auto-hide-wrapper.top {
  margin-left: var(--window-border, 4px) !important;
  margin-right: var(--window-border, 4px) !important;
}

.auto-hide-wrapper.bottom {
  margin-left: var(--window-border, 4px) !important;
  margin-right: var(--window-border, 4px) !important;
}

#browser:not(.fullscreen) .auto-hide-wrapper {
  box-sizing: border-box !important;
}

#panels-container.switcher,
#panels-container.icons #switch {
  width: 0 !important;
  min-width: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: hidden !important;
}
